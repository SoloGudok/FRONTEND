import React from "react";
import { Card, CardContent } from "@mui/material";
import { useNavigate } from "react-router-dom";
import "./SubscriptionCard.css";

export default function SubscriptionCard({ subscriptions }) {
  const navigate = useNavigate();

  const handleSubscriptionClick = (subscriptionId) => {
    navigate(`/subscription/${subscriptionId}`);
  };

  const handleCustomCombinationClick = () => {
    navigate("/membership");
  };

  // ê°€ê²© í¬ë§·íŒ… í•¨ìˆ˜ë¥¼ ë” ì•ˆì „í•˜ê²Œ ìˆ˜ì •
  const formatPrice = (price) => {
    // priceê°€ undefined, null, ë¹„ì–´ìˆê±°ë‚˜ ìˆ«ìë¡œ ë³€í™˜í•  ìˆ˜ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ê°’ ë°˜í™˜
    if (price === undefined || price === null || price === "" || isNaN(Number(price))) {
      return "ê°€ê²© ì •ë³´ ì—†ìŒ";
    }
    
    try {
      // ìˆ«ìë¡œ ë³€í™˜ í›„ ì²œ ë‹¨ìœ„ êµ¬ë¶„ì ì¶”ê°€
      return Number(price).toLocaleString('ko-KR');
    } catch (error) {
      console.error("ê°€ê²© í¬ë§·íŒ… ì˜¤ë¥˜:", error);
      return price.toString(); // ì˜¤ë¥˜ ë°œìƒ ì‹œ ì›ë³¸ ê°’ ë°˜í™˜
    }
  };

  // subscriptionsì´ ì—†ëŠ” ê²½ìš° ë¹ˆ ë°°ì—´ë¡œ ì²˜ë¦¬
  const safeSubscriptions = Array.isArray(subscriptions) ? subscriptions : [];

  return (
    <div className="subscription-card-grid">
      {/* ì²«ë²ˆì§¸ "ë‚´ ë§˜ëŒ€ë¡œ êµ¬ë… ì¡°í•©!" ì¹´ë“œ */}
      <Card
        variant="outlined"
        className="subscription-card-item custom-combination-card"
        sx={{
          borderRadius: 12,
          maxWidth: 200,
          height: 250,
          padding: "13px",
          textAlign: "center",
          cursor: "pointer",
          background: "linear-gradient(135deg, #6366F1, #8B5CF6)",
          color: "white",
          margin: "12px",
          boxShadow: "4px 4px 12px rgba(0, 0, 0, 0.1)",
        }}
        onClick={handleCustomCombinationClick}
      >
        <CardContent
          className="p-3"
          sx={{
            display: "flex",
            flexDirection: "column",
            alignItems: "center",
            justifyContent: "center",
            height: "100%",
            padding: "0 !important", // MUI CardContentì— ê¸°ë³¸ íŒ¨ë”© ì œê±°
          }}
        >
          <div className="subscription-card-img-container">
            <div className="custom-card-icon">ğŸ</div>
          </div>
          <p className="subscription-card-name" style={{ color: "white" }}>
          ë‚´ ë§˜ëŒ€ë¡œ<br />êµ¬ë… ì¡°í•©!
          </p>
          <p className="subscription-card-description">
            ë‚˜ë§Œì˜ êµ¬ë… ì„œë¹„ìŠ¤ë¥¼ ì¡°í•©í•´ë³´ì„¸ìš”
          </p>
        </CardContent>
      </Card>

      {/* ê¸°ì¡´ êµ¬ë… ì¹´ë“œë“¤ */}
      {safeSubscriptions.map((sub) => {
        // ê° í•­ëª©ë§ˆë‹¤ ì•ˆì „ ê²€ì‚¬
        const item = sub || {};
        const id = item.id || Math.random().toString();
        const name = item.name || "êµ¬ë… ì„œë¹„ìŠ¤";
        const imageUrl = item.imageUrl || null;
        const hasPrice = item.price !== undefined && item.price !== null;
        
        return (
          <Card
            key={id}
            variant="outlined"
            className="subscription-card-item"
            sx={{
              borderRadius: 12,
              maxWidth: 200,
              height: 250,
              padding: "13px",
              textAlign: "center",
              margin: "12px",
              boxShadow: "4px 4px 12px rgba(0, 0, 0, 0.1)",
            }}
          >
            <CardContent
              className="p-3"
              sx={{
                display: "flex",
                flexDirection: "column",
                alignItems: "center",
                justifyContent: "center",
                height: "100%",
                padding: "0 !important", // MUI CardContentì— ê¸°ë³¸ íŒ¨ë”© ì œê±°
              }}
            >
              {imageUrl && (
                <div className="subscription-card-img-container">
                  <img
                    src={imageUrl}
                    alt={name}
                    className="subscription-card-img"
                    onClick={() => handleSubscriptionClick(id)}
                    style={{ cursor: "pointer" }}
                  />
                </div>
              )}

              <p className="subscription-card-name">{name}</p>

              {hasPrice && (
                <p className="subscription-card-price">
                  {formatPrice(item.price)} / ë‹¬
                </p>
              )}
            </CardContent>
          </Card>
        );
      })}
    </div>
  );
}